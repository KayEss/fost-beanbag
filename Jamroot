path-constant TOP : . ;
include $(TOP)/../boost-version.jam ;

using testing ;

project
    :
        requirements

        <include>Cpp/include
        <include>../fost-base/Cpp/include
        <include>$(BOOST_HEADERS)
        <target-os>windows:<include>../OpenSSL/install/include/

        <threading>multi
        <runtime-link>shared

        <target-os>linux:<cxxflags>-Wl,-E

        <target-os>windows:<exception-handling>on
        <target-os>windows:<asynch-exceptions>on
        <target-os>windows:<extern-c-nothrow>off
        <target-os>windows:<debug-symbols>on
        <target-os>windows:<debug-store>database

        <target-os>windows:<define>WIN32
        <target-os>windows:<define>_AFXDLL
        <target-os>windows:<define>UNICODE
        <target-os>windows:<define>_UNICODE
    :
        default-build debug
    :
        build-dir $(BUILD_DIRECTORY)
    ;

rule smoke-test ( name : sources + ) {
    lib $(name) : $(sources) ;

    install ../../../dist/lib
        :
            $(name)
        :
            <target-os>linux:<install-dependencies>on
            <target-os>linux:<install-type>LIB
            <target-os>darwin:<install-dependencies>on
            <target-os>darwin:<install-type>LIB
            <target-os>windows:<install-type>XXX
        ;

    install ../../../dist/bin
        :
            $(name)
        :
            <install-dependencies>on
            <install-type>EXE
            <target-os>windows:<install-type>LIB
        ;

    local unit-test-name = $(name) "-unit" ;
    unit-test $(unit-test-name:J)
        :
            $(name)
            ../../../fost-base/Cpp/fost-test/boost-build-unit-test.cpp
        ;
}

build-project Cpp/fost-cache-test/ ;
build-project Cpp/fost-jsondb-test/ ;
build-project Cpp/fost-metamodel-test/ ;
build-project Cpp/fost-schema-test/ ;
build-project Cpp/fost-sql-test/ ;
